<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Biblioteca Solid√°ria - Cat√°logo</title>
  <link rel="stylesheet" href="css/catalogo.css" />
</head>

<body>
  <header>
    <h1>üìö Biblioteca Solid√°ria</h1>
    <nav>
      <a href="login.html">Login</a>
      <a href="solicitacoes.html">Minhas Solicita√ß√µes</a>
      <a href="gerenciar-livro.html">Doar livro</a>
      <a href="painel-usuario.html">perfil</a>
    </nav>
  </header>

  <main>
    <h2>Cat√°logo de Livros Dispon√≠veis</h2>
    <div class="filtros">
      <label for="filtro-genero">Filtrar por G√™nero:</label>
      <select id="filtro-genero">
        <option value="">Todos</option>
        <option value="science_fiction">Fic√ß√£o-Cient√≠fica</option>
        <option value="non_fiction">N√£o-Fic√ß√£o</option>
        <option value="adventure">Aventura</option>
        <option value="romance">Romance</option>
        <option value="horror">Horror</option>
        <option value="fantasy">Fantasia</option>
      </select>

      <label for="filtro-etaria">Filtrar por Faixa Et√°ria:</label>
      <select id="filtro-etaria">
        <option value="">Todas</option>
        <option value="all_ages">livre</option>
        <option value="10_and_up">10+</option>
        <option value="13_and_up">13+</option>
        <option value="16_and_up">16+</option>
        <option value="18_and_up">18+</option>
      </select>
    </div>

    <div id="livros-container">
      <!-- Os livros ser√£o inseridos aqui dinamicamente -->
    </div>
  </main>

  <script>
    const generoSelect = document.getElementById("filtro-genero");
    const etariaSelect = document.getElementById("filtro-etaria");

    const categoriasTraduzidas = {
      fantasy: "Fantasia",
      non_fiction: "N√£o-fic√ß√£o",
      adventure: "Aventura",
      romance: "Romance",
      horror: "Horror",
      science_fiction: "Fic√ß√£o cient√≠fica",
    };

    const classificacoesTraduzidas = {
      "18_and_up": "18+",
      "16_and_up": "16+",
      "13_and_up": "13+",
      "10_and_up": "10+",
      all_ages: "Livre",
    };

    function filtrarLivros() {
      const genero = generoSelect.value;
      const etaria = etariaSelect.value;
      const livros = document.querySelectorAll(".book-card");

      livros.forEach((livro) => {
        const generoLivro = livro.dataset.genero || "";
        const faixaEtariaLivro = livro.dataset.etaria || "";

        const generoCond = genero === "" || genero === generoLivro;
        const etariaCond = etaria === "" || etaria === faixaEtariaLivro;

        livro.style.display = generoCond && etariaCond ? "flex" : "none";
      });
    }

    generoSelect.addEventListener("change", filtrarLivros);
    etariaSelect.addEventListener("change", filtrarLivros);

    async function carregarLivros() {
      try {
        const response = await fetch(
          "http://127.0.0.1:8000/api/books/catalog"
        );
        const livros = await response.json();
        const livrosContainer = document.getElementById("livros-container");
        console.log(livros);

        if (livrosContainer) {
          livrosContainer.innerHTML = "";

          livros.forEach((livro) => {
            const livroCard = document.createElement("div");
            livroCard.classList.add("book-card");
            livroCard.dataset.genero = livro.category;
            livroCard.dataset.etaria = livro.classification;

            const categoriaTraduzida =
              categoriasTraduzidas[livro.category] || livro.category;
            const classificacaoTraduzida =
              classificacoesTraduzidas[livro.classification] ||
              livro.classification;

            livroCard.innerHTML = `
              <img src="img/livro.png" alt="Capa do livro" class="book-img">
              <div class="book-info">
              <p><strong>T√≠tulo:</strong> ${livro.title}</p> <!-- Atualizando para 'title' -->
              <p><strong>Autor:</strong> ${livro.author}</p> <!-- Atualizando para 'author' -->
              <p><strong>G√™nero:</strong>  ${categoriaTraduzida}</p> <!-- Atualizando para 'category' -->
              <p><strong>Classifica√ß√£o:</strong> ${classificacaoTraduzida}</p> <!-- Atualizando para 'classification' -->
              <p><strong>Status:</strong> ${livro.status === "available" ? "Dispon√≠vel" : "Indispon√≠vel"}</p> <!-- Traduzindo status -->
              <a href="info-livro.html?id=${livro.id}" class="edit-button">Solicitar</a>
              </div>`;
            livrosContainer.appendChild(livroCard);
          });
        }
      } catch (error) {
        console.error("Erro ao carregar livros:", error);
      }
    }

    window.onload = carregarLivros;
  </script>
</body>

</html>